<html>
  <head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.34.0/smoothie.js"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>

  <link href="https://fonts.googleapis.com/css?family=Roboto:100" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
  <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css')}}">

  </head>
  <body>
    <header class="navbar">
      <section class="navbar-section">
        <!-- <a href="#" class="btn btn-link">Docs</a>
        <a href="#" class="btn btn-link">Examples</a> -->
      </section>
      <section class="navbar-center">
        <span class="logo">LINE</span>
      </section>
      <section class="navbar-section">
        <!-- <a href="#" class="btn btn-link">Twitter</a>
        <a href="#" class="btn btn-link">GitHub</a> -->
      </section>
    </header>

    <div id="page" class="container" style="padding-bottom: 5px;">
      <div class="columns">
      <div class="col-12">
        <canvas id="line" width="2000px" height="1000px"></canvas>
      </div>
      </div>

      <div class="columns hashtags">
        <div class="col-5">#ichacklower</div>
        <div class="col-2 vs">vs</div>
        <div class="col-5">#ichackupper</div>
      </div>
      <div class="columns">
      	<div class="col-1"></div>
      	<div class="col-4">
      	  <div id="icupper">Waiting</div>
      	</div>
      	<div class="col-2"></div>
      	<div class="col-5">
      	  <div id="iclower">Waiting</div>
      	</div>
      </div>

    </div>

{% raw -%}
    <script id="handlebar-template" type="text/x-handlebars-template">
    <div class="tile" id="{{ linetag }}">
      <div class="tile-icon">
        <div class="example-tile-icon">
    <figure class="avatar avatar-xl" data-initial="YA" style="background-color: #FFF;">
      <img src="{{ profile_pic_url }}" alt="profile_pic">
    </figure>
        </div>
      </div>
      <div class="tile-content">
        <p class="tile-title">@{{ user_name }}</p>
        <p class="tile-subtitle text-gray">{{ message }}</p>
      </div>
    </div>
    </script>
{%- endraw %}

    <script type="text/javascript">
    $( document ).ready(function() {
      var source   = document.getElementById("handlebar-template").innerHTML;
      var template = Handlebars.compile(source);

      // Random data
      var line1 = new TimeSeries();
      var line2 = new TimeSeries();
      var socket = io.connect('http://localhost:5000');


      socket.on('points', function(msg) {
        line1.append(new Date().getTime(), msg.p);
      });

      socket.on('mentions', function(msg) {
        console.log(msg.user_name);
        var html = template(msg);
        // console.log(html);
        $('#'+msg.linetag).fadeOut('fast', function() {
            $('#'+msg.linetag).replaceWith(html);
            $('#'+msg.linetag).fadeIn('fast');
        });
      });

			window.addEventListener('resize', resizeCanvas, false);

    function resizeCanvas() {
						var canvas = document.getElementById("line");
            canvas.width = window.innerWidth;
            canvas.height = Math.max(450, window.innerHeight*0.60);

            /**
             * Your drawings need to be inside this function otherwise they will be reset when
             * you resize the browser window and the canvas goes will be cleared.
             */
    }
    resizeCanvas();

      var smoothie = new SmoothieChart(
        { grid: { strokeStyle: '#262626',
            fillStyle: '#262626',
            lineWidth: 1,
            millisPerLine: 250,
            verticalSections: 0
          }, labels: {
            disabled: false,
            fillStyle: "#656565",
            fontFamily: "Roboto, sans-serif",
            fontSize: 15,
            precision: 0
          }
        });
      smoothie.addTimeSeries(line1, { strokeStyle: '#d1d1d1', lineWidth: 2 });
      smoothie.addTimeSeries(line2, { strokeStyle: '#235ba0', lineWidth: 2 });

      smoothie.streamTo(document.getElementById("line"), 1000);
    });
    </script>

  </body>
</html>
